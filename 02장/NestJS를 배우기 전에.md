# 2.1 웹 프레임워크
## 2.2 Node.js
Nest는 Node.js를 기반으로 동작합니다. 정확히는 Nest로 작성한 소스코드를 Node.js 기반 프레임워크인 Express나 Fastify에서 실행 가능한 자바스크립트 소스코드로 컴파일해 주는 역할을 합니다. 따라서 Node.js의 동작원리를 이해하면 개발할 때 도움이 됩니다.

Node.js는 2009년에 릴리즈되었습니다. 그 전까지 자바스크립트는 프론트엔드에서만 사용하는 언어라는 인식이 강했고 실제로 그랬습니다. 웹 시장이 커질 때 동적 페이지를 다루기 위해 HTML내의 <script> 태그로 삽입하여 주로 사용했습니다. 자바가 인기를 얻으면서 이름이 비슷한 것도 입소문을 내기에 좋았습니다. 하지만 브라우저에 삽입된 소스코드가 그대로 노출되고 보안에 취약하다는 인식이 있었고 사용은 많이 하지만 "그냥 스크립트 언어"라는 괄시를 받았습니다. 이후 Node.js의 등장으로 자바스크립트를 이용하여 서버를 구동할 수 있게 되었습니다. 프론트엔드와 백엔드에서 같은 언어를 사용한다는 것은 큰 장점입니다. 같은 개발자가 풀스택2으로 개발할 경우 생산성을 향상시켜주고, 프론트엔드/백엔드가 분리되어 있다 하더라도 커뮤니케이션 비용을 줄여줍니다. Node.js의 등장으로 자바스크립트는 당당히 하나의 언어로 인정받게 되었습니다. 2008년 구글은 크롬 브라우저를 출시하면서 자체 개발한 자바스크립트 엔진인 V8을 크롬에 내장하였습니다. V8의 뛰어난 성능은 "자바스크립트는 느리다"는 인식을 바꾸어 주었습니다.

Node.js는 NPM(Node Package Manager)이라고 하는 패키지(또는 라이브러리) 관리 시스템을 가지고 있습니다. 누구나 자신이 만든 Node.js 기반 라이브러리를 등록하여 다른 사람들이 사용하게 공개할 수 있습니다. 공개하기는 싫지만 NPM을 이용하여 사내에서 패키지를 관리하고자 한다면 돈을 지불하고 비공개(Private)로 등록도 가능합니다. NPM 블로그에 따르면 2022년 3월 현재 등록된 패키지 수가 190만개에 다다르고 있습니다3. 대부분의 소스코드가 깃허브에 공개되고 있는데 깃허브는 2020년 3월 NPM을 인수하였습니다. 마이크로소프트가 깃허브를 인수하였으므로 사실상 NPM은 마이크로소프트가 주도하게 되었습니다. Nest 역시 Node.js를 기반으로 하므로 NPM을 그대로 사용할 수 있습니다. 개발에 필요한 라이브러리가 있다면 NPM CLI를 이용하여 설치하면 됩니다. 심지어 Nest 역시 NPM에 등록되어 있고 1장에서 본 것 처럼 NPM으로 설치합니다. Nest 관련 패키지들을 확인하고 싶다면 npmjs.com에서 @nestjs 로 검색해 보세요.
## Node.js의 특징
### 단일 쓰레드에서 구동되는 non-blocking I/O 이벤트 기반 비동기 방식
작업 요청이 한꺼번에 들어올 때 각 작업을 처리하기 위한 쓰레드를 만들고 할당하는 방식을 멀티 쓰레드 방식이라고 합니다. 멀티 쓰레드 방식은 여러 작업을 동시에 처리하므로 작업 처리속도가 빠른 장점이 있지만, 공유 자원을 관리하는 노력이 많이 들고 잘못 작성된 동기화로 인해 락에서 빠져나오지 못하는 경우가 발생하기 쉽습니다. 쓰레드가 늘어날 때 마다 메모리를 소모하게 되므로 메모리 관리 역시 중요합니다. 이에 비해 Node.js는 하나의 쓰레드에서 작업을 처리합니다. 사실 애플리케이션 단에서는 단일 쓰레드이지만 백그라운에서는 쓰레드 풀을 구성해 작업을 처리합니다. 개발자가 직접 쓰레드 풀을 관리하지 않고 플랫폼, 정확히는 Node.js에 포함된 libuv5가 그 역할을 하기 때문에 개발자는 단일 쓰레드에서 동작하는 것처럼 이해하기 쉬운 코드를 작성할 수 있습니다. 웹 서버를 운용할 때는 코어(CPU)를 분산해서 관리하므로 실제 작업은 여러개의 코어에서 별개로 처리됩니다.

Node.js는 이렇게 들어온 작업을 앞의 작업이 끝날때까지 기다리지 않고(non-blocking) 비동기로 처리합니다. 이 개념을 쉽게 설명하면 다음과 같습니다. 푸드코트의 경우 주문은 한 곳에서 받지만 음식은 입점된 각 식당에서 만듭니다. 음식이 완성된 순서대로 각 식당에서 호출벨을 통해 손님을 부르고 손님은 음식을 픽업합니다. 여기서 계산을 담당하는 작업은 단일 쓰레드이고 각 요리를 완성해 벨을 호출하는 식당들은 비동기로 요리를 준비합니다. 입력은 하나의 쓰레드에서 받지만 순서대로 처리 하지 않고 먼저 처리된 결과를 이벤트로 반환해주는 방식이 바로 Node.js가 사용하는 단일 쓰레드 non-blocking 이벤트 기반 비동기 방식입니다.

### Node.js의 장단점
앞에서 설명한 단일 쓰레드 이벤트 기반 비동기 방식은 서버의 자원에 크게 부하를 가하지 않습니다. 이는 대규모 네트워크 애플리케이션을 개발하기에 적합합니다. 물론 쓰레드를 하나만 사용하기 때문에 하나의 쓰레드에 문제가 생기게 되면 애플리케이션 전체가 오류를 일으킬 위험이 있습니다. 하나의 쓰레드로 동작하는 것처럼 코드를 작성할 수 있다는 점은 개발자에게 큰 장점입니다. 멀티 쓰레드를 직접 만들고 관리하면서 데드락에 빠져 본 분들은 그 어려움을 공감하실 것입니다.

Node.js의 단점은 아무래도 컴파일러 언어의 처리속도에 비해 그 성능이 떨어진다는 점입니다. 하지만 서버의 성능은 꾸준히 발전하고 있고, V8엔진의 성능이 계속 향상되고 있어 왠만한 웹 애플리케이션을 만들기에는 손색이 없습니다. 이벤트 기반 비동기 방식으로 복잡한 기능을 구현하다 보면 여러 이벤트를 동시에 처리하는 경우 콜백 지옥에 빠지는 경우가 있습니다. 코드가 대각선으로 쭉 들어쓰여 작성되면서 가독성이 떨어지고 이해하기 어려운 코드가 양산되는 경우가 빈번했습니다. 하지만 ECMAScript 2015(ES6)에서 Promise가 도입되면서 간결한 표현으로 작성할 수 있게 되었습니다. ECMAScript 2017에서는 async/await 기능이 추가되면서 비동기 동작을 마치 동기로 처리하는 것처럼 코드를 작성할 수 있게 되었습니다.
